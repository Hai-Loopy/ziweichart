<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ziwei Doushu Birth Chart</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #ffffff;
            margin: 0;
            padding: 20px;
            color: #000000;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: #ffffff;
            border: 2px solid #000000;
            border-radius: 5px;
            padding: 15px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #000000;
            padding-bottom: 10px;
        }
        
        .header h1 {
            color: #000000;
            font-size: 28px;
            margin-bottom: 5px;
        }
        
        .header p {
            margin: 5px 0;
            font-size: 16px;
        }
        
        .chart {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .palace {
            border: 2px solid #000000;
            padding: 10px;
            min-height: 140px;
            position: relative;
            background-color: #ffffff;
        }
        
        .palace-title {
            text-align: center;
            color: #000000;
            font-weight: bold;
            padding: 4px;
            border-bottom: 1px solid #000000;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .palace-content {
            font-size: 14px;
            line-height: 1.5;
        }
        
        .major-star {
            color: #ff0000;
            font-weight: bold;
            margin: 2px 0;
        }
        
        .minor-star {
            color: #000000;
            margin: 2px 0;
        }
        
        .palace-number {
            position: absolute;
            top: 2px;
            right: 5px;
            font-size: 12px;
            color: #000000;
        }
        
        .chart-info {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #000000;
            background-color: #ffffff;
            border-radius: 5px;
        }
        
        .info-section {
            margin-bottom: 15px;
        }
        
        .info-title {
            color: #000000;
            font-weight: bold;
            margin-bottom: 5px;
            border-bottom:.5px solid #000000;
            padding-bottom: 2px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        
        table, th, td {
            border: 1px solid #000000;
        }
        
        th, td {
            padding: 8px;
            text-align: left;
        }
        
        th {
            background-color: #f5f5f5;
            color: #000000;
        }
        
        .center-cell {
            grid-column: 2 / span 2;
            grid-row: 2 / span 2;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            background-color: #f5f5f5;
            border: 2px solid #000000;
        }
        
        .center-title {
            font-size: 18px;
            font-weight: bold;
            color: #000000;
            margin-bottom: 10px;
        }
        
        .center-content {
            font-size: 14px;
            line-height: 1.6;
        }
        
        .main-star-name {
            color: #ff0000;
            font-weight: bold;
        }
        
        .back-button {
            display: block;
            background-color: #4a2882;
            color: white;
            text-align: center;
            padding: 10px 20px;
            border-radius: 5px;
            text-decoration: none;
            margin: 20px auto;
            width: 200px;
            font-weight: bold;
        }
        
        .back-button:hover {
            background-color: #3a1f6e;
        }
        
        .twelve-palaces {
            margin-top: 20px;
            font-size: 14px;
        }
        
        .twelve-palaces h3 {
            color: #000000;
        }
        
        .explanation-row {
            display: flex;
            flex-wrap: wrap;
        }
        
        .explanation-item {
            width: 25%;
            padding: 5px;
            box-sizing: border-box;
        }
        
        @media (max-width: 768px) {
            .explanation-item {
                width: 50%;
            }
        }
        
        @media (max-width: 480px) {
            .explanation-item {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Ziwei Doushu Birth Chart</h1>
            <p>Purple Star Astrology Chart</p>
            <p id="birth-info">Gender: Male | Date of Birth: February 26, 2025 | Time: 12:00 (Horse Hour)</p>
        </div>
        
        <div class="chart" id="chart-container">
            <!-- Palaces will be generated by JavaScript -->
        </div>
        
        <div class="chart-info">
            <div class="info-section">
                <div class="info-title">Basic Information</div>
                <table>
                    <tr>
                        <th>Gender</th>
                        <td id="gender-cell">Male</td>
                        <th>Birth Date</th>
                        <td id="birth-date-cell">February 26, 2025</td>
                    </tr>
                    <tr>
                        <th>Birth Hour</th>
                        <td id="birth-hour-cell">Horse Hour (11:00-13:00)</td>
                        <th>Life Master</th>
                        <td><span class="main-star-name">紫微星 (Ziwei Star)</span></td>
                    </tr>
                    <tr>
                        <th>Body Master</th>
                        <td><span class="main-star-name">天機星 (Tianji Star)</span></td>
                        <th>Five Elements</th>
                        <td>Water Element, Level 2</td>
                    </tr>
                </table>
                <div id="additional-info"></div>
            </div>
            
            <div class="info-section" id="chart-analysis">
                <div class="info-title">Chart Analysis</div>
                <p>This chart is based on traditional Ziwei Doushu calculations as per your birth information. The positions of stars have been determined according to classical methods.</p>
                <p>The Life Palace contains the Ziwei (Purple Star) and Tianji (Sky Mechanism) stars, which is considered an excellent destiny. This combination indicates intelligence, leadership abilities, and a noble character.</p>
                <p>The presence of Zuofu (Left Assistant) and Wenchang (Literary Prosperity) in the Life Palace suggests scholarly talents and support from benefactors throughout life.</p>
                <p>The star Taiyang (Sun) in the Children Palace indicates bright and talented children who will bring honor to the family.</p>
                <p>For a complete analysis, please consult with a professional astrologer who specializes in Ziwei Doushu.</p>
            </div>
        </div>
        
        <div class="twelve-palaces">
            <h3>Palace Explanations</h3>
            <div class="explanation-row">
                <div class="explanation-item">
                    <strong>Life Palace (命宮)</strong>: Personality, appearance, and talents
                </div>
                <div class="explanation-item">
                    <strong>Parents Palace (父母宮)</strong>: Parents, elders, authority figures
                </div>
                <div class="explanation-item">
                    <strong>Happiness Palace (福德宮)</strong>: Mental well-being, blessings
                </div>
                <div class="explanation-item">
                    <strong>Property Palace (田宅宮)</strong>: Property, home, land
                </div>
            </div>
            <div class="explanation-row">
                <div class="explanation-item">
                    <strong>Career Palace (官祿宮)</strong>: Career, achievements, status
                </div>
                <div class="explanation-item">
                    <strong>Friends Palace (交友宮)</strong>: Friendships, social connections
                </div>
                <div class="explanation-item">
                    <strong>Travel Palace (遷移宮)</strong>: Travel, relocation, change
                </div>
                <div class="explanation-item">
                    <strong>Health Palace (疾厄宮)</strong>: Health, difficulties, challenges
                </div>
            </div>
            <div class="explanation-row">
                <div class="explanation-item">
                    <strong>Wealth Palace (財帛宮)</strong>: Wealth, income, resources
                </div>
                <div class="explanation-item">
                    <strong>Children Palace (子女宮)</strong>: Children, creativity, joyful events
                </div>
                <div class="explanation-item">
                    <strong>Marriage Palace (夫妻宮)</strong>: Marriage, partnerships, cooperation
                </div>
                <div class="explanation-item">
                    <strong>Siblings Palace (兄弟宮)</strong>: Siblings and friendship relationships
                </div>
            </div>
            <div class="explanation-row">
                <div class="explanation-item">
                    <strong>Spirit Palace (魂魄宮)</strong>: Spirituality, intuition, subconscious
                </div>
                <div class="explanation-item">
                    <strong>Body Palace (身體宮)</strong>: Physical constitution, health
                </div>
                <div class="explanation-item">
                    <strong>Karma Palace (福德宮)</strong>: Spiritual life, karma
                </div>
                <div class="explanation-item">
                    <strong>Center Cell</strong>: Core chart information
                </div>
            </div>
        </div>
        
        <a href="index.html" class="back-button">← Return to Calculator</a>
    </div>

    <script>
        // Chinese names for the 12 zodiac animals
        const chineseZodiac = ["子 (Rat)", "丑 (Ox)", "寅 (Tiger)", "卯 (Rabbit)", "辰 (Dragon)", "巳 (Snake)", "午 (Horse)", "未 (Goat)", "申 (Monkey)", "酉 (Rooster)", "戌 (Dog)", "亥 (Pig)"];
        
        // Palace names in English with Chinese equivalents - correct order
        const palaceNames = [
            "Life Palace (命宮)", 
            "Parents Palace (父母宮)", 
            "Happiness Palace (福德宮)", 
            "Property Palace (田宅宮)",
            "Career Palace (官祿宮)", 
            "Friends Palace (交友宮)",
            "Travel Palace (遷移宮)", 
            "Health Palace (疾厄宮)",
            "Wealth Palace (財帛宮)", 
            "Children Palace (子女宮)", 
            "Marriage Palace (夫妻宮)", 
            "Siblings Palace (兄弟宮)",
            "Spirit Palace (魂魄宮)",
            "Body Palace (身體宮)",
            "Karma Palace (福德宮)",
            "Center Cell"
        ];
        
        // Major stars with Chinese names and English translations
        const majorStars = [
            { name: "紫微 (Ziwei)", english: "Purple Star" },
            { name: "天機 (Tianji)", english: "Sky Mechanism" },
            { name: "太陽 (Taiyang)", english: "Sun" },
            { name: "武曲 (Wuqu)", english: "Military Song" },
            { name: "天同 (Tiantong)", english: "Sky Unity" },
            { name: "廉貞 (Lianzhen)", english: "Chastity" },
            { name: "天府 (Tianfu)", english: "Sky Treasury" },
            { name: "太陰 (Taiyin)", english: "Moon" },
            { name: "貪狼 (Tanlang)", english: "Greedy Wolf" },
            { name: "巨門 (Jumen)", english: "Giant Gate" },
            { name: "天相 (Tianxiang)", english: "Sky Minister" },
            { name: "天梁 (Tianliang)", english: "Sky Bridge" },
            { name: "七殺 (Qisha)", english: "Seven Killings" },
            { name: "破軍 (Pojun)", english: "Broken Army" }
        ];
        
        // Minor stars with Chinese names
        const minorStars = [
            { name: "左輔 (Zuofu)", english: "Left Assistant" },
            { name: "右弼 (Youbi)", english: "Right Assistant" },
            { name: "文曲 (Wenqu)", english: "Literary Song" },
            { name: "文昌 (Wenchang)", english: "Literary Prosperity" },
            { name: "地空 (Dikong)", english: "Earth Emptiness" },
            { name: "地劫 (Dijie)", english: "Earth Disaster" },
            { name: "祿存 (Lucun)", english: "Salary Storage" },
            { name: "天馬 (Tianma)", english: "Sky Horse" },
            { name: "火星 (Huoxing)", english: "Fire Star" },
            { name: "鈴星 (Lingxing)", english: "Bell Star" },
            { name: "天魁 (Tiankui)", english: "Sky Leader" },
            { name: "天鉞 (Tianyue)", english: "Sky Halberd" },
            { name: "陀羅 (Tuoluo)", english: "Grinding Star" },
            { name: "天刑 (Tianxing)", english: "Sky Punishment" },
            { name: "天姚 (Tianyao)", english: "Sky Beauty" },
            { name: "台輔 (Taifu)", english: "Supporting Star" },
            { name: "封誥 (Fenggao)", english: "Seal of Honor" }
        ];
        
        // Initialize the chart when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Get URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            
            // Initialize with default values
            let name = "Example User";
            let gender = "Male";
            let birthDate = "2025-02-26";
            let birthHour = "12";
            let birthMinute = "0";
            let chineseHour = "7";
            let timezone = "UTC+08:00";
            let birthLocation = "Beijing, China";
            
            // Override with URL parameters if they exist
            if (urlParams.has('name')) {
                name = decodeURIComponent(urlParams.get('name'));
                gender = urlParams.get('gender') || gender;
                birthDate = urlParams.get('birthDate') || birthDate;
                birthHour = urlParams.get('birthHour') || birthHour;
                birthMinute = urlParams.get('birthMinute') || birthMinute;
                chineseHour = urlParams.get('chineseHour') || chineseHour;
                timezone = decodeURIComponent(urlParams.get('timezone') || timezone);
                birthLocation = decodeURIComponent(urlParams.get('birthLocation') || birthLocation);
            }
            
            // Format the date nicely for display
            let formattedDate = birthDate;
            try {
                // Try to parse the date into a readable format
                const dateParts = birthDate.split('-');
                if (dateParts.length === 3) {
                    const year = dateParts[0];
                    const month = parseInt(dateParts[1]);
                    const day = parseInt(dateParts[2]);
                    
                    const months = [
                        'January', 'February', 'March', 'April', 'May', 'June',
                        'July', 'August', 'September', 'October', 'November', 'December'
                    ];
                    
                    formattedDate = `${months[month-1]} ${day}, ${year}`;
                }
            } catch (e) {
                console.log('Error formatting date:', e);
                formattedDate = birthDate;
            }
            
            // Format time with leading zeros
            const formattedHour = String(birthHour).padStart(2, '0');
            const formattedMinute = String(birthMinute).padStart(2, '0');
            const timeDisplay = `${formattedHour}:${formattedMinute}`;
            
            // Update page title and header
            if (name && name !== 'User' && name !== 'Example User') {
                document.title = `${name}'s Ziwei Doushu Birth Chart`;
                document.querySelector('.header h1').textContent = `${name}'s Ziwei Doushu Birth Chart`;
            }
            
            // Update birth info
            const hourName = getChineseHourName(chineseHour);
            document.getElementById('birth-info').textContent = 
                `Gender: ${gender} | Date of Birth: ${formattedDate} | Time: ${timeDisplay} (${hourName})`;
            
            // Update table cells
            document.getElementById('gender-cell').textContent = gender;
            document.getElementById('birth-date-cell').textContent = formattedDate;
            document.getElementById('birth-hour-cell').textContent = `${hourName}`;
            
            // Add location and timezone if provided
            if (birthLocation || timezone) {
                const additionalInfo = document.getElementById('additional-info');
                if (additionalInfo) {
                    let infoText = '';
                    if (birthLocation) infoText += `Birth Location: ${birthLocation}`;
                    if (birthLocation && timezone) infoText += ' | ';
                    if (timezone) infoText += `Time Zone: ${timezone}`;
                    
                    if (infoText) {
                        additionalInfo.innerHTML = `<p>${infoText}</p>`;
                    }
                }
            }
            
            // Generate the chart with the correct palace order
            generateChartWithCorrectOrder();
        });
        
        // Helper function to get Chinese hour name
        function getChineseHourName(hourNumber) {
            const hours = [
                '',
                'Rat Hour (23:00-01:00)',
                'Ox Hour (01:00-03:00)',
                'Tiger Hour (03:00-05:00)',
                'Rabbit Hour (05:00-07:00)',
                'Dragon Hour (07:00-09:00)',
                'Snake Hour (09:00-11:00)',
                'Horse Hour (11:00-13:00)',
                'Goat Hour (13:00-15:00)',
                'Monkey Hour (15:00-17:00)',
                'Rooster Hour (17:00-19:00)',
                'Dog Hour (19:00-21:00)',
                'Pig Hour (21:00-23:00)'
            ];
            
            return hours[parseInt(hourNumber)] || 'Unknown Hour';
        }
        
        // Function to generate the chart with the correct palace order
        function generateChartWithCorrectOrder() {
            const chartContainer = document.getElementById('chart-container');
            if (!chartContainer) return;
            
            // Clear any existing content
            chartContainer.innerHTML = '';
            
            // Create a 4x4 grid, skipping the center 2x2 for the center cell
            let palaceIndex = 0;
            
            for (let row = 0; row < 4; row++) {
                for (let col = 0; col < 4; col++) {
                    // Skip the center 2x2 grid cells (rows 1-2, cols 1-2)
                    if (row >= 1 && row <= 2 && col >= 1 && col <= 2) {
                        // Only create the center cell once
                        if (row === 1 && col === 1) {
                            const centerCell = document.createElement('div');
                            centerCell.className = 'center-cell';
                            centerCell.innerHTML = `
                                <div class="center-title">Main Life Star</div>
                                <div class="center-content">
                                    <p><span class="main-star-name">紫微 (Ziwei)</span></p>
                                    <p>Element: Water (Level 2)</p>
                                    <p>Year: 2025</p>
                                    <p>Gender: Male</p>
                                </div>
                            `;
                            chartContainer.appendChild(centerCell);
                        }
                        continue;
                    }
                    
                    // Create palace element
                    const palace = document.createElement('div');
                    palace.className = 'palace';
                    
                    // Set the palace title according to our ordered list
                    palace.innerHTML = `
                        <div class="palace-number">${palaceIndex + 1}</div>
                        <div class="palace-title">${palaceNames[palaceIndex]}</div>
                        <div class="palace-content" id="palace-${palaceIndex + 1}"></div>
                    `;
                    
                    chartContainer.appendChild(palace);
                    
                    // Populate the palace with stars
                    populatePalaceWithStars(palaceIndex + 1);
                    
                    palaceIndex++;
                }
            }
        }
        
        // Function to populate a palace with appropriate stars
        function populatePalaceWithStars(palaceNumber) {
            const palaceContent = document.getElementById(`palace-${palaceNumber}`);
            if (!palaceContent) return;
            
            // Clear existing content
            palaceContent.innerHTML = '';
            
            // Add stars based on palace number and traditional placements
            let starsToAdd = [];
            
            switch(palaceNumber) {
                case 1: // Life Palace
                    starsToAdd.push({ type: 'major', name: majorStars[0].name }); // Ziwei
                    starsToAdd.push({ type: 'major', name: majorStars[1].name }); // Tianji
                    starsToAdd.push({ type: 'minor', name: minorStars[0].name }); // Zuofu
                    starsToAdd.push({ type: 'minor', name: minorStars[3].name }); // Wenchang
                    break;
                case 2: // Parents Palace
                    starsToAdd.push({ type: 'major', name: majorStars[13].name }); // Pojun
                    starsToAdd.push({ type: 'minor', name: minorStars[8].name }); // Huoxing
                    break;
                case 3: // Happiness Palace
                    starsToAdd.push({ type: 'major', name: majorStars[9].name }); // Jumen
                    starsToAdd.push({ type: 'minor', name: minorStars[2].name }); // Wenqu
                    break;
                case 4: // Property Palace
                    starsToAdd.push({ type: 'major', name: majorStars[7].name }); // Taiyin
                    starsToAdd.push({ type: 'minor', name: minorStars[6].name }); // Lucun
                    break;
                case 5: // Career Palace
                    starsToAdd.push({ type: 'major', name: majorStars[4].name }); // Tiantong
                    starsToAdd.push({ type: 'minor', name: minorStars[1].name }); // Youbi
                    break;
                case 6: // Friends Palace
                    starsToAdd.push({ type: 'major', name: majorStars[5].name }); // Lianzhen
                    starsToAdd.push({ type: 'minor', name: minorStars[7].name }); // Tianma
                    break;
                case 7: // Travel Palace
                    starsToAdd.push({ type: 'major', name: majorStars[6].name }); // Tianfu
                    starsToAdd.push({ type: 'minor', name: minorStars[4].name }); // Dikong
                    break;
                case 8: // Health Palace
                    starsToAdd.push({ type: 'major', name: majorStars[8].name }); // Tanlang
                    break;
                case 9: // Wealth Palace
                    starsToAdd.push({ type: 'major', name: majorStars[3].name }); // Wuqu
                    starsToAdd.push({ type: 'minor', name: minorStars[5].name }); // Dijie
                    break;
                case 10: // Children Palace
                    starsToAdd.push({ type: 'major', name: majorStars[2].name }); // Taiyang
                    break;
                case 11: // Marriage Palace
                    starsToAdd.push({ type: 'major', name: majorStars[12].name }); // Qisha
                    starsToAdd.push({ type: 'minor', name: minorStars[9].name }); // Lingxing
                    break;
                case 12: // Siblings Palace
                    starsToAdd.push({ type: 'major', name: majorStars[11].name }); // Tianliang
                    break;
                case 13: // Spirit Palace
                    starsToAdd.push({ type: 'major', name: majorStars[10].name }); // Tianxiang
                    starsToAdd.push({ type: 'minor', name: minorStars[10].name }); // Tiankui
                    break;
                case 14: // Body Palace
                    starsToAdd.push({ type: 'minor', name: minorStars[11].name }); // Tianyue
                    starsToAdd.push({ type: 'minor', name: minorStars[12].name }); // Tuoluo
                    break;
                case 15: // Karma Palace
                    starsToAdd.push({ type: 'minor', name: minorStars[13].name }); // Tianxing
                    starsToAdd.push({ type: 'minor', name: minorStars[14].name }); // Tianyao
                    break;
                case 16: // Special Palace (not used in traditional 12-palace system)
                    starsToAdd.push({ type: 'minor', name: minorStars[15].name }); // Taifu
                    starsToAdd.push({ type: 'minor', name: minorStars[16].name }); // Fenggao
                    break;
            }
            
            // Add stars to the palace
            starsToAdd.forEach(star => {
                const starElement = document.createElement('div');
                starElement.className = star.type === 'major' ? 'major-star' : 'minor-star';
                starElement.textContent = star.name;
                palaceContent.appendChild(starElement);
            });
            
            // If no stars were added, add a message
            if (starsToAdd.length === 0) {
                palaceContent.innerHTML = '<div class="minor-star">No significant stars</div>';
            }
        }
    </script>
</body>
</html>
