<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ziwei Doushu Birth Chart</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #ffffff;
            margin: 0;
            padding: 20px;
            color: #000000;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: #ffffff;
            border: 2px solid #000000;
            border-radius: 5px;
            padding: 15px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #000000;
            padding-bottom: 10px;
        }
        
        .header h1 {
            color: #000000;
            font-size: 28px;
            margin-bottom: 5px;
        }
        
        .header p {
            margin: 5px 0;
            font-size: 16px;
        }
        
        .chart {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .palace {
            border: 2px solid #000000;
            padding: 10px;
            min-height: 140px;
            position: relative;
            background-color: #ffffff;
        }
        
        .palace-title {
            text-align: center;
            color: #000000;
            font-weight: bold;
            padding: 4px;
            border-bottom: 1px solid #000000;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .palace-content {
            font-size: 14px;
            line-height: 1.5;
        }
        
        .major-star {
            color: #ff0000;
            font-weight: bold;
            margin: 2px 0;
        }
        
        .minor-star {
            color: #000000;
            margin: 2px 0;
        }
        
        .palace-number {
            position: absolute;
            top: 2px;
            right: 5px;
            font-size: 12px;
            color: #000000;
        }
        
        .chart-info {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #000000;
            background-color: #ffffff;
            border-radius: 5px;
        }
        
        .info-section {
            margin-bottom: 15px;
        }
        
        .info-title {
            color: #000000;
            font-weight: bold;
            margin-bottom: 5px;
            border-bottom:.5px solid #000000;
            padding-bottom: 2px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        
        table, th, td {
            border: 1px solid #000000;
        }
        
        th, td {
            padding: 8px;
            text-align: left;
        }
        
        th {
            background-color: #f5f5f5;
            color: #000000;
        }
        
        .twelve-palaces {
            margin-top: 20px;
            font-size: 14px;
        }
        
        .twelve-palaces h3 {
            color: #000000;
        }
        
        .explanation-row {
            display: flex;
            flex-wrap: wrap;
        }
        
        .explanation-item {
            width: 25%;
            padding: 5px;
            box-sizing: border-box;
        }
        
        @media (max-width: 768px) {
            .chart {
                grid-template-columns: repeat(2, 1fr);
                grid-template-rows: repeat(8, 1fr);
            }
            
            .explanation-item {
                width: 50%;
            }
        }
        
        @media (max-width: 480px) {
            .explanation-item {
                width: 100%;
            }
        }
        
        .destiny-pillars {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 15px 0;
        }
        
        .pillar {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 60px;
        }
        
        .pillar-box {
            border: 1px solid #000000;
            width: 100%;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 2px 0;
            background-color: #ffffff;
        }
        
        .pillar-label {
            font-size: 12px;
            color: #000000;
            text-align: center;
        }
        
        .center-cell {
            grid-column: 2 / span 2;
            grid-row: 2 / span 2;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            background-color: #f5f5f5;
            border: 2px solid #000000;
        }
        
        .center-title {
            font-size: 18px;
            font-weight: bold;
            color: #000000;
            margin-bottom: 10px;
        }
        
        .center-content {
            font-size: 14px;
            line-height: 1.6;
        }
        
        .main-star-name {
            color: #ff0000;
            font-weight: bold;
        }
        
        .back-button {
            display: block;
            background-color: #4a2882;
            color: white;
            text-align: center;
            padding: 10px 20px;
            border-radius: 5px;
            text-decoration: none;
            margin: 20px auto;
            width: 200px;
            font-weight: bold;
        }
        
        .back-button:hover {
            background-color: #3a1f6e;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Ziwei Doushu Birth Chart</h1>
            <p>Purple Star Astrology Chart</p>
            <p id="birth-info">Gender: Male | Date of Birth: February 26, 2025 | Time: 12:00 (Horse Hour)</p>
            
            <div class="destiny-pillars">
                <div class="pillar">
                    <div class="pillar-label">Year</div>
                    <div class="pillar-box">己</div>
                    <div class="pillar-box">巳</div>
                </div>
                <div class="pillar">
                    <div class="pillar-label">Month</div>
                    <div class="pillar-box">甲</div>
                    <div class="pillar-box">寅</div>
                </div>
                <div class="pillar">
                    <div class="pillar-label">Day</div>
                    <div class="pillar-box">丙</div>
                    <div class="pillar-box">午</div>
                </div>
                <div class="pillar">
                    <div class="pillar-label">Hour</div>
                    <div class="pillar-box">丁</div>
                    <div class="pillar-box">未</div>
                </div>
            </div>
        </div>
        
        <div class="chart" id="chart-grid">
            <!-- Palace placeholders - will be filled by JavaScript -->
        </div>
        
        <div class="chart-info">
            <div class="info-section">
                <div class="info-title">Basic Information</div>
                <table>
                    <tr>
                        <th>Gender</th>
                        <td id="gender-cell">Male</td>
                        <th>Birth Date</th>
                        <td id="birth-date-cell">February 26, 2025</td>
                    </tr>
                    <tr>
                        <th>Birth Hour</th>
                        <td id="birth-hour-cell">Horse Hour (11:00-13:00)</td>
                        <th>Life Master</th>
                        <td id="life-master-cell"><span class="main-star-name">Ziwei Star</span></td>
                    </tr>
                    <tr>
                        <th>Body Master</th>
                        <td id="body-master-cell"><span class="main-star-name">Tianji Star</span></td>
                        <th>Five Elements</th>
                        <td id="elements-cell">Water Element, Level 2</td>
                    </tr>
                </table>
                <div id="additional-info"></div>
            </div>
            
            <div class="info-section" id="chart-analysis">
                <div class="info-title">Chart Analysis</div>
                <p>This chart is based on your birth information. The positions of stars in the chart represent different aspects of your life and personality.</p>
                <p>The main stars (highlighted in red) are the primary influences in each palace, while the minor stars modify and add nuance to these influences.</p>
                <p>For a complete and accurate reading, please consult with a professional Ziwei Doushu astrologer who can provide a detailed interpretation of all star interactions and their implications for your life.</p>
            </div>
        </div>
        
        <div class="twelve-palaces">
            <h3>Palace Explanations</h3>
            <div class="explanation-row">
                <div class="explanation-item">
                    <strong>Life Palace</strong>: Represents personality, appearance, and talents
                </div>
                <div class="explanation-item">
                    <strong>Siblings Palace</strong>: Represents siblings and friendship relationships
                </div>
                <div class="explanation-item">
                    <strong>Marriage Palace</strong>: Represents marriage, partnerships, and cooperation
                </div>
                <div class="explanation-item">
                    <strong>Children Palace</strong>: Represents children, creativity, and joyful events
                </div>
            </div>
            <div class="explanation-row">
                <div class="explanation-item">
                    <strong>Wealth Palace</strong>: Represents wealth, income, and resources
                </div>
                <div class="explanation-item">
                    <strong>Health Palace</strong>: Represents health, difficulties, and challenges
                </div>
                <div class="explanation-item">
                    <strong>Travel Palace</strong>: Represents travel, relocation, and change
                </div>
                <div class="explanation-item">
                    <strong>Friends Palace</strong>: Represents friendships, social relationships, and networking
                </div>
            </div>
            <div class="explanation-row">
                <div class="explanation-item">
                    <strong>Career Palace</strong>: Represents career, achievements, and status
                </div>
                <div class="explanation-item">
                    <strong>Property Palace</strong>: Represents real estate, residences, and land
                </div>
                <div class="explanation-item">
                    <strong>Happiness Palace</strong>: Represents mental well-being, blessings, and leisure
                </div>
                <div class="explanation-item">
                    <strong>Parents Palace</strong>: Represents parents, elders, and authority figures
                </div>
            </div>
            <div class="explanation-row">
                <div class="explanation-item">
                    <strong>Spirit Palace</strong>: Represents spirituality, intuition, and the subconscious
                </div>
                <div class="explanation-item">
                    <strong>Body Palace</strong>: Represents physical constitution and health conditions
                </div>
                <div class="explanation-item">
                    <strong>Karma Palace</strong>: Represents blessings, spiritual life, and karma
                </div>
                <div class="explanation-item">
                    <strong>Center</strong>: Core chart information
                </div>
            </div>
        </div>
        
        <a href="index.html" class="back-button">← Return to Calculator</a>
    </div>

    <script>
        // Basic Ziwei Doushu star calculation
        document.addEventListener('DOMContentLoaded', function() {
            // Get URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            
            // Initialize with default values
            let name = "Example User";
            let gender = "Male";
            let birthDate = "2025-02-26";
            let birthHour = "12";
            let birthMinute = "0";
            let chineseHour = "7";
            let timezone = "UTC+08:00";
            let birthLocation = "Beijing, China";
            
            // Override with URL parameters if they exist
            if (urlParams.has('name')) {
                name = decodeURIComponent(urlParams.get('name'));
                gender = urlParams.get('gender') || gender;
                birthDate = urlParams.get('birthDate') || birthDate;
                birthHour = urlParams.get('birthHour') || birthHour;
                birthMinute = urlParams.get('birthMinute') || birthMinute;
                chineseHour = urlParams.get('chineseHour') || chineseHour;
                timezone = decodeURIComponent(urlParams.get('timezone') || timezone);
                birthLocation = decodeURIComponent(urlParams.get('birthLocation') || birthLocation);
            }
            
            // Format the date nicely for display
            let formattedDate = birthDate;
            try {
                // Try to parse the date into a readable format
                const dateParts = birthDate.split('-');
                if (dateParts.length === 3) {
                    const year = dateParts[0];
                    const month = parseInt(dateParts[1]);
                    const day = parseInt(dateParts[2]);
                    
                    const months = [
                        'January', 'February', 'March', 'April', 'May', 'June',
                        'July', 'August', 'September', 'October', 'November', 'December'
                    ];
                    
                    formattedDate = `${months[month-1]} ${day}, ${year}`;
                }
            } catch (e) {
                console.log('Error formatting date:', e);
                formattedDate = birthDate;
            }
            
            // Format time with leading zeros
            const formattedHour = String(birthHour).padStart(2, '0');
            const formattedMinute = String(birthMinute).padStart(2, '0');
            const timeDisplay = `${formattedHour}:${formattedMinute}`;
            
            // Update page title and header
            if (name && name !== 'User') {
                document.title = `${name}'s Ziwei Doushu Birth Chart`;
                document.querySelector('.header h1').textContent = `${name}'s Ziwei Doushu Birth Chart`;
            }
            
            // Update birth info
            const hourName = getChineseHourName(chineseHour);
            document.getElementById('birth-info').textContent = 
                `Gender: ${gender} | Date of Birth: ${formattedDate} | Time: ${timeDisplay} (${hourName})`;
            
            // Add location and timezone if provided
            if (birthLocation || timezone) {
                const additionalInfo = document.getElementById('additional-info');
                if (additionalInfo) {
                    let infoText = '';
                    if (birthLocation) infoText += `Birth Location: ${birthLocation}`;
                    if (birthLocation && timezone) infoText += ' | ';
                    if (timezone) infoText += `Time Zone: ${timezone}`;
                    
                    if (infoText) {
                        additionalInfo.innerHTML = `<p>${infoText}</p>`;
                    }
                }
            }
            
            // Generate the Ziwei Doushu chart based on birth information
            generateChart(birthDate, parseInt(chineseHour), gender);
        });
        
        // Helper function to get Chinese hour name
        function getChineseHourName(hourNumber) {
            const hours = [
                '',
                'Rat Hour (23:00-01:00)',
                'Ox Hour (01:00-03:00)',
                'Tiger Hour (03:00-05:00)',
                'Rabbit Hour (05:00-07:00)',
                'Dragon Hour (07:00-09:00)',
                'Snake Hour (09:00-11:00)',
                'Horse Hour (11:00-13:00)',
                'Goat Hour (13:00-15:00)',
                'Monkey Hour (15:00-17:00)',
                'Rooster Hour (17:00-19:00)',
                'Dog Hour (19:00-21:00)',
                'Pig Hour (21:00-23:00)'
            ];
            
            return hours[parseInt(hourNumber)] || 'Unknown Hour';
        }
        
        // Palace names in English
        const palaceNames = [
            "Life Palace",
            "Parents Palace",
            "Fortune Palace", 
            "Property Palace",
            "Career Palace",
            "Friends Palace", 
            "Travel Palace", 
            "Health Palace",
            "Wealth Palace", 
            "Children Palace", 
            "Marriage Palace", 
            "Siblings Palace",
            "Happiness Palace",
            "Spirit Palace",
            "Body Palace",
            "Karma Palace"
        ];
        
        // Major stars with Chinese names and English translations
        const majorStars = [
            { name: "紫微 (Ziwei)", english: "Purple Star" },
            { name: "天機 (Tianji)", english: "Sky Mechanism" },
            { name: "太陽 (Taiyang)", english: "Sun" },
            { name: "武曲 (Wuqu)", english: "Military Song" },
            { name: "天同 (Tiantong)", english: "Sky Unity" },
            { name: "廉貞 (Lianzhen)", english: "Chastity" },
            { name: "天府 (Tianfu)", english: "Sky Treasury" },
            { name: "太陰 (Taiyin)", english: "Moon" },
            { name: "貪狼 (Tanlang)", english: "Greedy Wolf" },
            { name: "巨門 (Jumen)", english: "Giant Gate" },
            { name: "天相 (Tianxiang)", english: "Sky Minister" },
            { name: "天梁 (Tianliang)", english: "Sky Bridge" },
            { name: "七殺 (Qisha)", english: "Seven Killings" },
            { name: "破軍 (Pojun)", english: "Broken Army" }
        ];
        
        // Minor stars
        const minorStars = [
            { name: "左輔 (Zuofu)", english: "Left Assistant" },
            { name: "右弼 (Youbi)", english: "Right Assistant" },
            { name: "文曲 (Wenqu)", english: "Literary Song" },
            { name: "文昌 (Wenchang)", english: "Literary Prosperity" },
            { name: "地空 (Dikong)", english: "Earth Emptiness" },
            { name: "地劫 (Dijie)", english: "Earth Disaster" },
            { name: "祿存 (Lucun)", english: "Salary Storage" },
            { name: "天馬 (Tianma)", english: "Sky Horse" },
            { name: "火星 (Huoxing)", english: "Fire Star" },
            { name: "鈴星 (Lingxing)", english: "Bell Star" },
            { name: "天魁 (Tiankui)", english: "Sky Leader" },
            { name: "天鉞 (Tianyue)", english: "Sky Halberd" },
            { name: "陀羅 (Tuoluo)", english: "Grinding Star" },
            { name: "天刑 (Tianxing)", english: "Sky Punishment" },
            { name: "天姚 (Tianyao)", english: "Sky Beauty" },
            { name: "台輔 (Taifu)", english: "Supporting Star" },
            { name: "封誥 (Fenggao)", english: "Seal of Honor" }
        ];
        
        // Function to generate a simplified Ziwei Doushu chart
        function generateChart(birthDate, chineseHour, gender) {
            const chartGrid = document.getElementById('chart-grid');
            if (!chartGrid) return;
            
            // Clear existing chart
            chartGrid.innerHTML = '';
            
            // Parse birth date
            const dateParts = birthDate.split('-');
            if (dateParts.length !== 3) return;
            
            const birthYear = parseInt(dateParts[0]);
            const birthMonth = parseInt(dateParts[1]);
            const birthDay = parseInt(dateParts[2]);
            
            // Determine life palace position based on month and hour
            // This is a simplified calculation - real Ziwei Doushu uses lunar calendar
            let lifePalacePosition = ((birthMonth - 1) * 2 + Math.floor(chineseHour / 7) + 1) % 12;
            if (lifePalacePosition === 0) lifePalacePosition = 12;
            
            // Create the 16 palaces (12 main palaces + 4 additional)
            for (let i = 0; i < 16; i++) {
                // Skip center cell positions
                if (i === 5 || i === 6 || i === 9 || i === 10) {
                    const centerCell = document.createElement('div');
                    
                    // Only create the center content once
                    if (i === 5) {
                        centerCell.className = 'center-cell';
                        centerCell.innerHTML = `
                            <div class="center-title">Main Life Star</div>
                            <div class="center-content">
                                <p><span class="main-star-name">Ziwei Star</span></p>
                                <p>Element: Water (Level 2)</p>
                                <p id="birth-year">Year: ${birthYear}</p>
                                <p id="gender-display">Gender: ${gender}</p>
                            </div>
                        `;
                        chartGrid.appendChild(centerCell);
                    }
                    continue;
                }
                
                // Create palace element
                const palace = document.createElement('div');
                palace.className = 'palace';
                
                // Adjust index for center cell offset
                let palaceIndex = i;
                if (i > 10) palaceIndex -= 4;
                
                // Calculate palace position relative to life palace
                let palacePosition = (lifePalacePosition + palaceIndex) % 12;
                if (palacePosition === 0) palacePosition = 12;
                
                // For additional palaces beyond the 12 main ones
                if (i >= 12) {
                    palacePosition = i - 11; // 13th-16th positions
                }
                
                // Set palace number and title
                palace.innerHTML = `
                    <div class="palace-number">${i + 1}</div>
                    <div class="palace-title">${palaceNames[i]}</div>
                    <div class="palace-content" id="palace-${i + 1}"></div>
                `;
                
                chartGrid.appendChild(palace);
                
                // Populate palace with stars based on position
                populatePalace(i + 1, palacePosition, birthYear, birthMonth, birthDay, chineseHour);
            }
            
            // Update life master and body master in the info section
            document.getElementById('life-master-cell').innerHTML = '<span class="main-star-name">紫微 (Ziwei)</span>';
            document.getElementById('body-master-cell').innerHTML = '<span class="main-star-name">天機 (Tianji)</span>';
            
            // Generate simplified interpretation text
            generateInterpretation(lifePalacePosition, gender);
        }
        
        // Function to populate a palace with stars
        function populatePalace(palaceNumber, position, year, month, day, hour) {
            const palaceContent = document.getElementById(`palace-${palaceNumber}`);
            if (!palaceContent) return;
            
            // Clear existing content
            palaceContent.innerHTML = '';
            
            // This is a very simplified star distribution
            // In real Ziwei Doushu, star placements are calculated with complex formulas
            
            // Determine major stars for this palace based on position
            // This is a simplified approximation
            let majorStarsHere = [];
            
            // Life Palace (simplified - first palace always gets Ziwei and Tianji)
            if (palaceNumber === 1) {
                majorStarsHere.push(majorStars[0]); // Ziwei
                majorStarsHere.push(majorStars[1]); // Tianji
            }
            // Fixed position stars based on palace position
            else if (position === 1) majorStarsHere.push(majorStars[13]); // Pojun
            else if (position === 2) majorStarsHere.push(majorStars[2]); // Taiyang
            else if (position === 3) majorStarsHere.push(majorStars[3]); // Wuqu
            else if (position === 4) majorStarsHere.push(majorStars[4]); // Tiantong
            else if (position === 5) majorStarsHere.push(majorStars[5]); // Lianzhen
            else if (position === 6) majorStarsHere.push(majorStars[6]); // Tianfu
            else if (position === 7) majorStarsHere.push(majorStars[7]); // Taiyin
            else if (position === 8) majorStarsHere.push(majorStars[8]); // Tanlang
            else if (position === 9) majorStarsHere.push(majorStars[9]); // Jumen
            else if (position === 10) majorStarsHere.push(majorStars[10]); // Tianxiang
            else if (position === 11) majorStarsHere.push(majorStars[11]); // Tianliang
            else if (position === 12) majorStarsHere.push(majorStars[12]); // Qisha
            
            // For additional palaces (13-16)
            if (palaceNumber >= 13) {
                // Additional palaces get fewer major stars
                if (palaceNumber === 13) majorStarsHere.push(majorStars[10]); // Tianxiang for Happiness
            }
            
            // Add minor stars based on palace number and birth day
            // This is a simplified distribution
            const minorStarsHere = [];
            
            // Add fixed minor stars to certain palaces
            if (palaceNumber === 1) {
                minorStarsHere.push(minorStars[0]); // Zuofu
                minorStarsHere.push(minorStars[3]); // Wenchang
            } else if (palaceNumber === 2) {
                minorStarsHere.push(minorStars[8]); // Huoxing
            } else if (palaceNumber === 3) {
                minorStarsHere.push(minorStars[5]); // Dijie
            } else if (palaceNumber === 4) {
                minorStarsHere.push(minorStars[6]); // Lucun
            } else if (palaceNumber === 5) {
                minorStarsHere.push(minorStars[1]); // Youbi
            } else if (palaceNumber === 6) {
                minorStarsHere.push(minorStars[7]); // Tianma
            } else if (palaceNumber === 7) {
                minorStarsHere.push(minorStars[4]); // Dikong
            } else if (palaceNumber === 9) {
                minorStarsHere.push(minorStars[2]); // Wenqu
            } else if (palaceNumber === 11) {
                minorStarsHere.push(minorStars[9]); // Lingxing
            } else if (palaceNumber === 13) {
                minorStarsHere.push(minorStars[10]); // Tiankui
            } else if (palaceNumber === 14) {
                minorStarsHere.push(minorStars[11]); // Tianyue
                minorStarsHere.push(minorStars[12]); // Tuoluo
            } else if (palaceNumber === 15) {
                minorStarsHere.push(minorStars[13]); // Tianxing
                minorStarsHere.push(minorStars[14]); // Tianyao
            } else if (palaceNumber === 16) {
                minorStarsHere.push(minorStars[15]); // Taifu
                minorStarsHere.push(minorStars[16]); // Fenggao
            }
            
            // Add major stars to palace
            majorStarsHere.forEach(star => {
                const starElement = document.createElement('div');
                starElement.className = 'major-star';
                starElement.textContent = star.name;
                palaceContent.appendChild(starElement);
            });
            
            // Add minor stars to palace
            minorStarsHere.forEach(star => {
                const starElement = document.createElement('div');
                starElement.className = 'minor-star';
                starElement.textContent = star.name;
                palaceContent.appendChild(starElement);
            });
            
            // If no stars were added, add a message
            if (majorStarsHere.length === 0 && minorStarsHere.length === 0) {
                palaceContent.innerHTML = '<div class="minor-star">No significant stars</div>';
            }
        }
        
        // Function to generate a simplified interpretation
        function generateInterpretation(lifePalacePosition, gender) {
            const analysisSection = document.getElementById('chart-analysis');
            if (!analysisSection) return;
            
            let interpretation = '<div class="info-title">Chart Analysis</div>';
            
            // Start with basic life palace analysis
            interpretation += `<p>Your Life Palace contains the <span class="main-star-name">Ziwei (Purple Star)</span> and 
                <span class="main-star-name">Tianji (Sky Mechanism)</span>, which is considered an excellent destiny. 
                Ziwei represents nobility and leadership, while Tianji represents intelligence and analytical ability. 
                The combination of these two major stars indicates exceptional intelligence, strong leadership abilities, 
                and potential for success.</p>`;
            
            // Add analysis based on the birth hour
            interpretation += `<p>The presence of Zuofu and Wenchang in your Life Palace enhances your scholarly talents 
                and literary
