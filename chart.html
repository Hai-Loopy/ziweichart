<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ziwei Doushu Birth Chart</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #ffffff;
            margin: 0;
            padding: 20px;
            color: #000000;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: #ffffff;
            border: 2px solid #000000;
            border-radius: 5px;
            padding: 15px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #000000;
            padding-bottom: 10px;
        }
        
        .header h1 {
            color: #000000;
            font-size: 28px;
            margin-bottom: 5px;
        }
        
        .header p {
            margin: 5px 0;
            font-size: 16px;
        }
        
        .chart {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .palace {
            border: 2px solid #000000;
            padding: 10px;
            min-height: 140px;
            position: relative;
            background-color: #ffffff;
        }
        
        .palace-title {
            text-align: center;
            color: #000000;
            font-weight: bold;
            padding: 4px;
            border-bottom: 1px solid #000000;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .palace-content {
            font-size: 14px;
            line-height: 1.5;
        }
        
        .major-star {
            color: #ff0000;
            font-weight: bold;
            margin: 2px 0;
        }
        
        .minor-star {
            color: #000000;
            margin: 2px 0;
        }
        
        .palace-number {
            position: absolute;
            top: 2px;
            right: 5px;
            font-size: 12px;
            color: #000000;
        }
        
        .chart-info {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #000000;
            background-color: #ffffff;
            border-radius: 5px;
        }
        
        .info-section {
            margin-bottom: 15px;
        }
        
        .info-title {
            color: #000000;
            font-weight: bold;
            margin-bottom: 5px;
            border-bottom:.5px solid #000000;
            padding-bottom: 2px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        
        table, th, td {
            border: 1px solid #000000;
        }
        
        th, td {
            padding: 8px;
            text-align: left;
        }
        
        th {
            background-color: #f5f5f5;
            color: #000000;
        }
        
        .twelve-palaces {
            margin-top: 20px;
            font-size: 14px;
        }
        
        .twelve-palaces h3 {
            color: #000000;
        }
        
        .explanation-row {
            display: flex;
            flex-wrap: wrap;
        }
        
        .explanation-item {
            width: 25%;
            padding: 5px;
            box-sizing: border-box;
        }
        
        @media (max-width: 768px) {
            .chart {
                grid-template-columns: repeat(2, 1fr);
                grid-template-rows: repeat(8, 1fr);
            }
            
            .explanation-item {
                width: 50%;
            }
        }
        
        @media (max-width: 480px) {
            .explanation-item {
                width: 100%;
            }
        }
        
        .destiny-pillars {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 15px 0;
        }
        
        .pillar {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 60px;
        }
        
        .pillar-box {
            border: 1px solid #000000;
            width: 100%;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 2px 0;
            background-color: #ffffff;
        }
        
        .pillar-label {
            font-size: 12px;
            color: #000000;
            text-align: center;
        }
        
        .center-cell {
            grid-column: 2 / span 2;
            grid-row: 2 / span 2;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            background-color: #f5f5f5;
            border: 2px solid #000000;
        }
        
        .center-title {
            font-size: 18px;
            font-weight: bold;
            color: #000000;
            margin-bottom: 10px;
        }
        
        .center-content {
            font-size: 14px;
            line-height: 1.6;
        }
        
        .main-star-name {
            color: #ff0000;
            font-weight: bold;
        }
        
        .back-button {
            display: block;
            background-color: #4a2882;
            color: white;
            text-align: center;
            padding: 10px 20px;
            border-radius: 5px;
            text-decoration: none;
            margin: 20px auto;
            width: 200px;
            font-weight: bold;
        }
        
        .back-button:hover {
            background-color: #3a1f6e;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Ziwei Doushu Birth Chart</h1>
            <p>Purple Star Astrology Chart</p>
            <p id="birth-info">Gender: Male | Date of Birth: February 26, 2025 | Time: 12:00 (Horse Hour)</p>
            
            <div class="destiny-pillars">
                <div class="pillar">
                    <div class="pillar-label">Year</div>
                    <div class="pillar-box">乙</div>
                    <div class="pillar-box">巳</div>
                </div>
                <div class="pillar">
                    <div class="pillar-label">Month</div>
                    <div class="pillar-box">甲</div>
                    <div class="pillar-box">寅</div>
                </div>
                <div class="pillar">
                    <div class="pillar-label">Day</div>
                    <div class="pillar-box">丙</div>
                    <div class="pillar-box">午</div>
                </div>
                <div class="pillar">
                    <div class="pillar-label">Hour</div>
                    <div class="pillar-box">丁</div>
                    <div class="pillar-box">未</div>
                </div>
            </div>
        </div>
        
        <div class="chart" id="chart-grid">
            <!-- Palace placeholders - will be filled by JavaScript -->
        </div>
        
        <div class="chart-info">
            <div class="info-section">
                <div class="info-title">Basic Information</div>
                <table>
                    <tr>
                        <th>Gender</th>
                        <td id="gender-cell">Male</td>
                        <th>Birth Date</th>
                        <td id="birth-date-cell">February 26, 2025</td>
                    </tr>
                    <tr>
                        <th>Birth Hour</th>
                        <td id="birth-hour-cell">Horse Hour (11:00-13:00)</td>
                        <th>Life Master</th>
                        <td id="life-master-cell"><span class="main-star-name">Ziwei Star</span></td>
                    </tr>
                    <tr>
                        <th>Body Master</th>
                        <td id="body-master-cell"><span class="main-star-name">Tianji Star</span></td>
                        <th>Five Elements</th>
                        <td id="elements-cell">Water Element, Level 2</td>
                    </tr>
                </table>
                <div id="additional-info"></div>
            </div>
            
            <div class="info-section" id="chart-analysis">
                <div class="info-title">Chart Analysis</div>
                <p>This chart is based on traditional Ziwei Doushu calculations as per your birth information. The positions of stars have been determined according to classical methods described in Vietnamese Ziwei Doushu references.</p>
                <p>For a complete analysis, please consult with a professional astrologer who specializes in Ziwei Doushu. They can provide detailed interpretations about how these star placements may influence different aspects of your life journey.</p>
            </div>
        </div>
        
        <div class="twelve-palaces">
            <h3>Palace Explanations</h3>
            <div class="explanation-row">
                <div class="explanation-item">
                    <strong>Life Palace (Mệnh)</strong>: Personality, appearance, and talents
                </div>
                <div class="explanation-item">
                    <strong>Siblings Palace (Huynh Đệ)</strong>: Siblings and friendship relationships
                </div>
                <div class="explanation-item">
                    <strong>Marriage Palace (Phu Thê)</strong>: Marriage, partnerships, cooperation
                </div>
                <div class="explanation-item">
                    <strong>Children Palace (Tử Tức)</strong>: Children, creativity, joyful events
                </div>
            </div>
            <div class="explanation-row">
                <div class="explanation-item">
                    <strong>Wealth Palace (Tài Bạch)</strong>: Wealth, income, resources
                </div>
                <div class="explanation-item">
                    <strong>Health Palace (Bệnh Tật)</strong>: Health, difficulties, challenges
                </div>
                <div class="explanation-item">
                    <strong>Travel Palace (Di)</strong>: Travel, relocation, change
                </div>
                <div class="explanation-item">
                    <strong>Friends Palace (Bạn Bè)</strong>: Friendships, social connections
                </div>
            </div>
            <div class="explanation-row">
                <div class="explanation-item">
                    <strong>Career Palace (Quan Lộc)</strong>: Career, achievements, status
                </div>
                <div class="explanation-item">
                    <strong>Property Palace (Điền Trạch)</strong>: Property, home, land
                </div>
                <div class="explanation-item">
                    <strong>Happiness Palace (Phúc Đức)</strong>: Mental well-being, blessings
                </div>
                <div class="explanation-item">
                    <strong>Parents Palace (Phụ Mẫu)</strong>: Parents, elders, authority figures
                </div>
            </div>
            <div class="explanation-row">
                <div class="explanation-item">
                    <strong>Spirit Palace (Âm Dương)</strong>: Spirituality, intuition, subconscious
                </div>
                <div class="explanation-item">
                    <strong>Body Palace (Thân)</strong>: Physical constitution, health
                </div>
                <div class="explanation-item">
                    <strong>Karma Palace (Phúc)</strong>: Blessings, spiritual life, karma
                </div>
                <div class="explanation-item">
                    <strong>Center</strong>: Core chart information
                </div>
            </div>
        </div>
        
        <a href="index.html" class="back-button">← Return to Calculator</a>
    </div>

    <script>
        // Traditional Ziwei Doushu calculations
        document.addEventListener('DOMContentLoaded', function() {
            // Get URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            
            // Initialize with default values
            let name = "Example User";
            let gender = "Male";
            let birthDate = "2025-02-26";
            let birthHour = "12";
            let birthMinute = "0";
            let chineseHour = "7";
            let timezone = "UTC+08:00";
            let birthLocation = "Beijing, China";
            
            // Override with URL parameters if they exist
            if (urlParams.has('name')) {
                name = decodeURIComponent(urlParams.get('name'));
                gender = urlParams.get('gender') || gender;
                birthDate = urlParams.get('birthDate') || birthDate;
                birthHour = urlParams.get('birthHour') || birthHour;
                birthMinute = urlParams.get('birthMinute') || birthMinute;
                chineseHour = urlParams.get('chineseHour') || chineseHour;
                timezone = decodeURIComponent(urlParams.get('timezone') || timezone);
                birthLocation = decodeURIComponent(urlParams.get('birthLocation') || birthLocation);
            }
            
            // Format the date nicely for display
            let formattedDate = birthDate;
            try {
                // Try to parse the date into a readable format
                const dateParts = birthDate.split('-');
                if (dateParts.length === 3) {
                    const year = dateParts[0];
                    const month = parseInt(dateParts[1]);
                    const day = parseInt(dateParts[2]);
                    
                    const months = [
                        'January', 'February', 'March', 'April', 'May', 'June',
                        'July', 'August', 'September', 'October', 'November', 'December'
                    ];
                    
                    formattedDate = `${months[month-1]} ${day}, ${year}`;
                }
            } catch (e) {
                console.log('Error formatting date:', e);
                formattedDate = birthDate;
            }
            
            // Format time with leading zeros
            const formattedHour = String(birthHour).padStart(2, '0');
            const formattedMinute = String(birthMinute).padStart(2, '0');
            const timeDisplay = `${formattedHour}:${formattedMinute}`;
            
            // Update page title and header
            if (name && name !== 'User') {
                document.title = `${name}'s Ziwei Doushu Birth Chart`;
                document.querySelector('.header h1').textContent = `${name}'s Ziwei Doushu Birth Chart`;
            }
            
            // Update birth info
            const hourName = getChineseHourName(chineseHour);
            document.getElementById('birth-info').textContent = 
                `Gender: ${gender} | Date of Birth: ${formattedDate} | Time: ${timeDisplay} (${hourName})`;
            
            // Add location and timezone if provided
            if (birthLocation || timezone) {
                const additionalInfo = document.getElementById('additional-info');
                if (additionalInfo) {
                    let infoText = '';
                    if (birthLocation) infoText += `Birth Location: ${birthLocation}`;
                    if (birthLocation && timezone) infoText += ' | ';
                    if (timezone) infoText += `Time Zone: ${timezone}`;
                    
                    if (infoText) {
                        additionalInfo.innerHTML = `<p>${infoText}</p>`;
                    }
                }
            }
            
            // Generate the Ziwei Doushu chart based on birth information
            generateTraditionalChart(birthDate, parseInt(chineseHour), gender);
        });
        
        // Helper function to get Chinese hour name
        function getChineseHourName(hourNumber) {
            const hours = [
                '',
                'Rat Hour (23:00-01:00)',
                'Ox Hour (01:00-03:00)',
                'Tiger Hour (03:00-05:00)',
                'Rabbit Hour (05:00-07:00)',
                'Dragon Hour (07:00-09:00)',
                'Snake Hour (09:00-11:00)',
                'Horse Hour (11:00-13:00)',
                'Goat Hour (13:00-15:00)',
                'Monkey Hour (15:00-17:00)',
                'Rooster Hour (17:00-19:00)',
                'Dog Hour (19:00-21:00)',
                'Pig Hour (21:00-23:00)'
            ];
            
            return hours[parseInt(hourNumber)] || 'Unknown Hour';
        }
        
        // Vietnamese names for the 12 zodiac animals (Chi)
        const vietnameseZodiac = ["Tý", "Sửu", "Dần", "Mão", "Thìn", "Tỵ", "Ngọ", "Mùi", "Thân", "Dậu", "Tuất", "Hợi"];
        
        // Palace names in English with Vietnamese equivalents
        const palaceNames = [
            "Life Palace (Mệnh)", 
            "Parents Palace (Phụ Mẫu)", 
            "Fortune Palace (Tài Bạch)", 
            "Property Palace (Điền Trạch)",
            "Career Palace (Quan Lộc)", 
            "Friends Palace (Nô Bộc)", 
            "Travel Palace (Di)", 
            "Health Palace (Tật Ách)",
            "Wealth Palace (Tài Bạch)", 
            "Children Palace (Tử Tức)", 
            "Marriage Palace (Phu Thê)", 
            "Siblings Palace (Huynh Đệ)",
            "Happiness Palace (Phúc Đức)",
            "Spirit Palace (Âm Dương)",
            "Body Palace (Thân)",
            "Karma Palace (Phúc)"
        ];
        
        // Major stars with Chinese, Vietnamese and English names
        const majorStars = [
            { name: "紫微 (Tử Vi)", english: "Purple Star" },
            { name: "天機 (Thiên Cơ)", english: "Sky Mechanism" },
            { name: "太陽 (Thái Dương)", english: "Sun" },
            { name: "武曲 (Vũ Khúc)", english: "Military Song" },
            { name: "天同 (Thiên Đồng)", english: "Sky Unity" },
            { name: "廉貞 (Liêm Trinh)", english: "Chastity" },
            { name: "天府 (Thiên Phủ)", english: "Sky Treasury" },
            { name: "太陰 (Thái Âm)", english: "Moon" },
            { name: "貪狼 (Tham Lang)", english: "Greedy Wolf" },
            { name: "巨門 (Cự Môn)", english: "Giant Gate" },
            { name: "天相 (Thiên Tướng)", english: "Sky Minister" },
            { name: "天梁 (Thiên Lương)", english: "Sky Bridge" },
            { name:
